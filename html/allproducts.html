<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>All Products | Stuffington</title>
    <!-- Link to favicon -->
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <!-- Link to external style sheet -->
    <link rel="stylesheet" type="text/css" href="../css/navigation.css">
    <link rel="stylesheet" type="text/css" href="../css/CategoryStyle.css">

    <script>
        function getParams() {
            var idx = document.URL.indexOf('?');
            var params = new Array();
            if (idx != -1) {
                var pairs = document.URL.substring(idx + 1, document.URL.length).split('&');
                for (var i = 0; i < pairs.length; i++) {
                    nameVal = pairs[i].split('=');
                    params[nameVal[0]] = nameVal[1];
                }
            }
            return params;
        }
        params = getParams();
        console.log(params);
        var category = unescape(params["category"]);

    </script>

</head>

<body>
    <!-- Navigation section -->
    <div class="navigationContainer">
        <ul class="navbar">
            <li><a href="index.html"><img src="../images/Stuffed.png"></a></li>
            <li><input type="text" class="searchbar" placeholder="Search.."></li>
            <li style="float:right"><a href="cart.html">üõí</a></li>
            <li style="float:right"><a href="profile.html">üë§</a></li>
            <li style="float:right"><a href="login.html">SIGN IN</a></li>
            <li style="float:right"><a href="aboutUs.html">ABOUT US</a></li>
        </ul>
        <ul class="categoryNavbar">
            <li><a id="allProductsBtn">All Products</a></li>
            <li><a id="teddyBearBtn">Teddy Bear</a></li>
            <li><a id="housePetsBtn">House Pets</a></li>
            <li><a id="mythicalBtn">Mythical</a></li>
        </ul>
    </div>

    <!-- Contents of the page -->
    <h1 class="heading" id="heading">ALL STUFFED TOYS</h1>

    <!-- div for the contents of the page -->
    <div class="categoryDisplayContainer">
        <!-- div for the filter bar on the left side -->
        <div class="sidebar">
            <h1>Filter By</h1>
            <p>Category:</p>
            <label><input type="checkbox" id="teddyBear">Teddy Bear</label>
            <label><input type="checkbox" id="housePets">House Pets</label>
            <label><input type="checkbox" id="mythical">Mythical</label>
            <br>
            <br>

            <p>Sizes:</p>
            <label><input type="checkbox" id="4inches">04 Inches</label>
            <label><input type="checkbox" id="8inches">08 Inches</label>
            <label><input type="checkbox" id="12inches">12 Inches</label>
            <br>
            <br>

            <p>Colour:</p>
            <label><input type="checkbox" id="brown">Brown</label>
            <label><input type="checkbox" id="blue">Blue</label>
            <label><input type="checkbox" id="white">White</label>
            <br>
            <br>

            <p>Price:</p>
            <label><input type="checkbox" id="1-25"> 01 - 25 AED</label>
            <label><input type="checkbox" id="26-50"> 26 - 50 AED</label>
            <label><input type="checkbox" id="51-75"> 51 - 75 AED</label>
            <br>
            <br>
        </div>


        <!-- div for the main contents of the page which displays all the products -->
        <div id="mainContainer" class="mainContainer">

        </div>
    </div>

    <script type="module">
        "use strict";

        let pageHeading = document.getElementById("heading");
        let container = document.getElementById("mainContainer");

        if (category === "undefined") {
            category = "";
        }

        let allProductsBtn = document.getElementById("allProductsBtn");
        allProductsBtn.onclick = () => {
            category = "";
            init();
        };

        let teddyBearBtn = document.getElementById("teddyBearBtn");
        teddyBearBtn.onclick = () => {
            category = "Teddy Bear";
            init();
        };

        let housePetsBtn = document.getElementById("housePetsBtn");
        housePetsBtn.onclick = () => {
            category = "House Pets";
            init();
        };

        let mythicalBtn = document.getElementById("mythicalBtn");
        mythicalBtn.onclick = () => {
            category = "Mythical";
            init();
        };

        window.onload = init;

        //Downloads JSON description of products from server
        function init() {
            //Create request object 
            let request = new XMLHttpRequest();

            //Create event handler that specifies what should happen when server responds
            request.onload = () => {
                //Check HTTP status code
                if (request.status === 200) {
                    //Add data from server to page
                    console.log(request.responseText);
                    displayProducts(request.responseText);
                }
                else
                    alert("Error communicating with server: " + request.status);
            };


            //Set up request and send it
            request.open("GET", "../php/products.php?category=" + category);
            request.send();
        }

        // function productCategory(category){
        //     //Create request object 
        //     let request = new XMLHttpRequest();


        //     request.onload = () => {
        //         //check HTTP status code
        //         if (request.status === 200){
        //             //Add data from server to page
        //             displayProducts(request.responseText);
        //         }
        //         else
        //             alert("Error communicating with server: " + request.status);
        //     };

        //     let url = "../php/products.php?category=" + category;

        //     //Set up request and send it
        //     request.open("GET", url, true);
        //     request.send();
        // }

        //Loads products into page
        function displayProducts(jsonProducts) {

            if (category == "Teddy Bear") {
                pageHeading.innerText = "TEDDY BEAR";
            }
            else if (category == "House Pets") {
                pageHeading.innerText = "HOUSE PETS";
            }
            else if (category == "Mythical") {
                pageHeading.innerText = "MYTHICAL";
            }
            else {
                pageHeading.innerText = "ALL PRODUCTS";
            }

            //Convert JSON to array of product objects
            let prodArray = JSON.parse(jsonProducts);
            console.log(prodArray);
            let htmlStr = "";

            //Create HTML table containing product data
            for (let i = 0; i < prodArray.length; i++) {

                htmlStr += '<div class="card">';
                // htmlStr += '<span style="visibility: hidden;" id="itemId">'+ prodArray[i]._id.$oid +'</span>';
                htmlStr += '<a href="productDisplay.html?name=' + prodArray[i].name + '">';
                htmlStr += '<img src="' + prodArray[i].image_url + '" alt="' + prodArray[i].name + '" style="width: 100%;">';
                htmlStr += '<h1>' + prodArray[i].name + '</h1>';
                htmlStr += '<p class="price">AED' + prodArray[i].price + '</p></a>';
                htmlStr += '<p><button>Add to Cart</button></p></div>';
            }

            container.innerHTML = htmlStr;
        }

    </script>

    <!-- footer -->
    <footer>
        <p>¬©Ô∏è 2023 - STUFFINGTON - All Rights Reserved</p>
    </footer>
</body>

</html>