<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Home | Stuffington</title>
    <!-- Link to favicon -->
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <!-- Link to external style sheet -->
    <link rel="stylesheet" type="text/css" href="../css/navigation.css">
</head>

<body>
    <!-- Navigation section -->
    <div class="navigationContainer">
        <ul class="navbar">
            <li><a href="index.html"><img src="../images/Stuffed.png"></a></li>
            <li><input type="search" class="searchbar" id="searchbar" placeholder="Search.."></li>
            <li style="float:right"><a href="cart.html">üõí</a></li>
            <li style="float:right"><a href="profile.html">üë§</a></li>
            <li style="float:right"><a href="login.html">SIGN IN</a></li>
            <li style="float:right"><a href="aboutUs.html">ABOUT US</a></li>
        </ul>
        <ul class="categoryNavbar">
            <li><a href="allproducts.html">All Products</a></li>
            <li><a href="allproducts.html?category=Teddy Bear">Teddy Bear</a></li>
            <li><a href="allproducts.html?category=House Pets">House Pets</a></li>
            <li><a href="allproducts.html?category=Mythical">Mythical</a></li>
        </ul>
    </div>

    <!-- Contents of the page -->
    <!--div for advertisement carousel-->
    <div class="featured_container">
        <span id="slide-1"></span>
        <span id="slide-2"></span>
        <span id="slide-3"></span>
        <div class="image-container">
            <img src="../images/stuffingtonAd1.png" class="slide" width="1063.3px" height="500px" />
            <img src="../images/stuffingtonAd2.png" class="slide" width="1063.3px" height="500px" />
            <img src="../images/stuffingtonAd3.png" class="slide" width="1063.3px" height="500px" />
        </div>
        <div class="dots">
            <a href="#slide-1"></a>
            <a href="#slide-2"></a>
            <a href="#slide-3"></a>
        </div>
    </div>


    <h1 class="heading">FEATURED STUFFED TOYS</h1>

    <!-- div for displaying featured products -->
    <div id ="recommendationContainer" class="recommendationContainer">
        <!-- <div class="card">
            <a href="productDisplay.html?name=Brown Bunny">
                <img src="../images/StuffedToys/BrownBunny.jpg" alt="BrownBunny" style="width: 100%;">
                <h1 id="lol">Brown Bunny</h1>
                <p class="price">AED50.00</p>
            </a>
            <p><button onclick="addTocart()">Add to Cart</button></p>
        </div>
        <div class="card">
            <a href="Products/blackDragon.html">
                <img src="../images/StuffedToys/BlackDragon.jpg" alt="BlackDragon" style="width: 100%;">
                <h1>Black Dragon</h1>
                <p class="price">AED75.00</p>
            </a>
            <p><button onclick="addTocart()">Add to Cart</button></p>
        </div>
        <div class="card">
            <a href="Products/brownBear.html">
                <img src="../images/StuffedToys/BrownBear.jpg" alt="BrownBear" style="width: 100%;">
                <h1>Brown Bear</h1>
                <p class="price">AED70.95</p>
            </a>
            <p><button onclick="addTocart()">Add to Cart</button></p>
        </div>
        <div class="card">
            <a href="Products/brownDog.html">
                <img src="../images/StuffedToys/BrownDog.jpg" alt="BrownDog" style="width: 100%;">
                <h1>Brown Dog</h1>
                <p class="price">AED17.95</p>
            </a>
            <p><button onclick="addTocart()">Add to Cart</button></p>
        </div> -->
    </div>

    <!-- js for searchbar functionality -->
    <script type="module">
        "use strict"
        //Import recommender class
        import { Recommender } from '../js/searchbar.js';

        //Create recommender object - it loads its state from session storage
        let recommender = new Recommender();

        //searchbar functionality
        let searchBar = document.getElementById("searchbar");
        searchBar.onsearch = function () {
            //add keyword to sessionStorage
            recommender.addKeyword(searchBar.value);
            //display searched product
            recommender.search();
        }

        let topKeyword = recommender.getTopKeyword();
        let container = document.getElementById("recommendationContainer");

        window.onload = init;

        //Downloads JSON description of products from server
        function init() {
            //Create request object 
            let request = new XMLHttpRequest();

            //Create event handler that specifies what should happen when server responds
            request.onload = () => {
                //Check HTTP status code
                if (request.status === 200) {

                    //Add data from server to page

                    displayRecommendedProducts(request.responseText);
                }
                else
                    alert("Error communicating with server: " + request.status);
            };


            //Set up request and send it
            if (topKeyword != "" && topKeyword != "undefined") {
                request.open("GET", "../php/products.php?search=" + topKeyword);
            }
            else {
                request.open("GET", "../php/products.php");
            }
            request.send();
        }

        function displayRecommendedProducts(jsonProducts) {

            if (jsonProducts == "]") {
                topKeyword = "";
                init();
            }

            //Convert JSON to array of product objects
            let prodArray = JSON.parse(jsonProducts);


            console.log(prodArray);
            let htmlStr = "";

            //Create HTML div containing product data
            let i = 0;
            let index = 0;
            let prodIDs=[];
            do  {
                
                if(prodArray.length>4){
                    index = Math.floor(Math.random() * prodArray.length);
                    if (index in prodIDs){
                        continue;
                    }
                }
                
                htmlStr += '<div class="card">';
                // htmlStr += '<span style="visibility: hidden;" id="itemId">'+ prodArray[i]._id.$oid +'</span>';
                htmlStr += '<a href="productDisplay.html?name=' + prodArray[index].name + '">';
                htmlStr += '<img src="' + prodArray[index].image_url + '" alt="' + prodArray[index].name + '" style="width: 100%;">';
                htmlStr += '<h1>' + prodArray[index].name + '</h1>';
                htmlStr += '<p class="price">AED' + prodArray[index].price + '</p></a>';
                htmlStr += '<p><button>Add to Cart</button></p></div>';
                prodIDs.push(index);
                index += 1;
                i += 1;
            }
            while(i<4 && i<prodArray.length);
            console.log(prodIDs);


            container.innerHTML = htmlStr;

        }


    </script>

    <!-- footer -->
    <footer>
        <p>¬©Ô∏è 2023 - STUFFINGTON - All Rights Reserved</p>
    </footer>
</body>

</html>