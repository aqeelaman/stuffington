<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <!-- Link to favicon -->
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <!-- Link to external style sheet -->
    <link rel="stylesheet" type="text/css" href="../css/navigation.css">
    <link rel="stylesheet" type="text/css" href="../css/productDisplay.css">

    <script>
        function getParams() {
            var idx = document.URL.indexOf('?');
            var params = new Array();
            if (idx != -1) {
                var pairs = document.URL.substring(idx + 1, document.URL.length).split('&');
                for (var i = 0; i < pairs.length; i++) {
                    nameVal = pairs[i].split('=');
                    params[nameVal[0]] = nameVal[1];
                }
            }
            return params;
        }
        params = getParams();
        console.log(params);
    </script>

</head>

<body>
    
    <!-- Navigation section -->
    <div class="navigationContainer">

        <ul class="navbar">
            <li><a href="index.html"><img src="../images/Stuffed.png"></a></li>
            <li><input type="search" id="searchbar" class="searchbar" placeholder="Search.."></li>
            <li style="float:right"><a href="cart.html">üõí</a></li>
            <li style="float:right"><a href="profile.html">üë§</a></li>
            <li style="float:right"><a href="login.html">SIGN IN</a></li>
            <li style="float:right"><a href="aboutUs.html">ABOUT US</a></li>
        </ul>
        <ul class="categoryNavbar">
            <li><a href="allproducts.html">All Products</a></li>
            <li><a href="allproducts.html?category=Teddy Bear">Teddy Bear</a></li>
            <li><a href="allproducts.html?category=House Pets">House Pets</a></li>
            <li><a href="allproducts.html?category=Mythical">Mythical</a></li>
        </ul>
    </div>

    <!-- Content of the Page-->
    <!-- container to display the product -->
    <div class="productDisplayContainer">

        <!-- container for product image -->
        <div class="imageDisplayContainer">
            <img id="itemImage">
        </div>

        <!-- container to display the text for each product i.e., Name,price,quantity and description-->
        <div class="textDisplayContainer">
            <!-- <p style="visibility:hidden;" id="itemId"></p> -->
            <h1 id="itemName" style="margin-top: 5px;"></h1>
            <p><span id="itemPrice" class="itemPrice"></span> Inclusive of VAT</p>
            <p>
                <select style="width: 8%; text-align: center;">
                    <option value="1" selected="selected"> 1 </option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                </select>
                <span><button id="addToCartBtn" class="addToCartBtn">Add To Cart</button></span>
            </p>
            <p>Delivered in 1 - 2 days</p>
            <div class="descriptionBox" id="descriptionBox">
                <table>
                    <tr>
                        <td>Item Count:</td>
                        <td id="itemCount">1 Piece</td>
                    </tr>
                    <tr>
                        <td>Size:</td>
                        <td id="itemSize"></td>
                    </tr>
                    <tr>
                        <td>Colour: </td>
                        <td id="itemColour"></td>
                    </tr>
                    <tr>
                        <td>Category: </td>
                        <td id="itemCategory"></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <!-- js for searchbar functionality -->
    <script type="module">
        "use strict"
        //Import recommender class
        import { Recommender } from '../js/searchbar.js';

        //Create recommender object - it loads its state from session storage
        let recommender = new Recommender();

        //searchbar functionality
        let searchBar = document.getElementById("searchbar");
        searchBar.onsearch = function(){
            //add keyword to sessionStorage
            recommender.addKeyword(searchBar.value);
            //display searched product
            recommender.search();
        }
    </script>

    <script type="module">
        "use strict";
        window.onload = init;

        function init(){

            //Create request object 
            let request = new XMLHttpRequest();

            //Create event handler that specifies what should happen when server responds
            request.onload = () => {
                //Check HTTP status code
                if (request.status === 200) {
                    //Add data from server to page
                    console.log(request.responseText);
                    displayProduct(request.responseText);
                }
                else
                    alert("Error communicating with server: " + request.status);
            };

            let url = "../php/products.php?name=" + unescape(params["name"]);
            //Set up request and send it
            request.open("GET", url);
            request.send();
        }

        function displayProduct(jsonProduct){
            let prodArray = JSON.parse(jsonProduct);
            console.log(prodArray);

            document.title = prodArray[0].name + " | Stuffington";
            // document.getElementById("itemId").innerText = prodArray[0]._id.$oid;
            document.getElementById("itemImage").src= prodArray[0].image_url;
            document.getElementById("itemName").innerText= prodArray[0].name;
            document.getElementById("itemPrice").innerText= "AED" + prodArray[0].price;
            document.getElementById("itemSize").innerText= prodArray[0].size;
            document.getElementById("itemColour").innerText= prodArray[0].colour;
            document.getElementById("itemCategory").innerText= prodArray[0].category;
        }
    </script>


    <!-- Recommendations -->
    <br><br>
    <h1 style="text-align: center;">People Also Buy</h1>

    <!-- container for recommendations  -->
    <div class="recommendContainer">
        <a href="rainbowBear.html">
            <div class="card">
                <img src="../images/StuffedToys/RainbowBear.jpg" alt="RainbowBear" style="width: 100%;">
                <h1>Rainbow Bear</h1>
                <p class="price">AED20.25</p>
                <p><button>Add to Cart</button></p>
            </div>
        </a>
        <a href="greyBear.html">
            <div class="card">
                <img src="../images/StuffedToys/GreyBear.jpg" alt="GreyBear" style="width: 100%;">
                <h1>Grey Bear</h1>
                <p class="price">AED23.90</p>
                <p><button>Add to Cart</button></p>
            </div>
        </a>
        <a href="pinkBear.html">
            <div class="card">
                <img src="../images/StuffedToys/PinkBear.jpg" alt="PinkBear" style="width: 100%;">
                <h1>Pink Bear</h1>
                <p class="price">AED45.99</p>
                <p><button>Add to Cart</button></p>
            </div>
        </a>
        <a href="brownDog.html">
            <div class="card">
                <img src="../images/StuffedToys/BrownDog.jpg" alt="BrownDog" style="width: 100%;">
                <h1>Brown Dog</h1>
                <p class="price">AED17.95</p>
                <p><button>Add to Cart</button></p>
            </div>
        </a>
    </div>

    <!-- footer -->
    <footer>
        <p>¬©Ô∏è 2023 - STUFFINGTON - All Rights Reserved</p>
    </footer>

</body>

</html>