<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Cart | Stuffington</title>
    <!-- Link to favicon -->
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <!-- Link to external style sheet -->
    <link rel="stylesheet" type="text/css" href="../css/navigation.css">
    <link rel="stylesheet" type="text/css" href="../css/CategoryStyle.css">
    <link rel="stylesheet" type="text/css" href="../css/CartStyle.css">
    <script src="../js/cart.js"></script>
</head>

<body>
    <div class="navigationContainer">
        <!-- Navigation section -->
        <ul class="navbar">
            <li><a href="index.html"><img src="../images/Stuffed.png"></a></li>
            <li><input type="search" id="searchbar" class="searchbar" placeholder="Search.."></li>
            <li style="float:right"><a href="cart.html">🛒</a></li>
            <li style="float:right"><a href="profile.html">👤</a></li>
            <li style="float:right"><a href="login.html">SIGN IN</a></li>
            <li style="float:right"><a href="aboutUs.html">ABOUT US</a></li>
        </ul>
        <ul class="categoryNavbar">
            <li><a href="allproducts.html">All Products</a></li>
            <li><a href="allproducts.html?category=Teddy Bear">Teddy Bear</a></li>
            <li><a href="allproducts.html?category=House Pets">House Pets</a></li>
            <li><a href="allproducts.html?category=Mythical">Mythical</a></li>
        </ul>
    </div>

    <!-- Content of the Page-->

    <!--A header that indicates what the content below it is-->
    <h1 style="margin-left: 4%; font-size: 35pt;"> Cart </h1>

    <!--A cart container would be placed on the left side of the screen showing what content the user has added to the cart-->
    <!--This consist of a div and many more div inside it to be able to adjust their position easily-->
    <div style="display: flex">
        <div class="cartDisplayContainer">

            <!--each lsited product would be created with a div called sideCart-->
            <div class="sideCart">
                <div class="itemImage"> <!-- Shows the image of the product-->
                    <img src="../images/StuffedToys/BrownBear.jpg" alt="BrownBear">
                </div>
                <div class="itemText"> <!--Div to control the texts of the product listed-->
                    <h1>Brown Bear</h1>
                    <p class="price">AED70.95</p>
                    <p><select style="width: 8%; text-align: center;">
                            <!-- A drop down menu that allows the user to select the quantity of each product-->
                            <option value="#"> 1 </option>
                            <option value="#" selected="selected">2</option>
                            <option value="#">3</option>
                            <option value="#">4</option>
                            <option value="#">5</option>
                            <option value="#">6</option>
                            <option value="#">7</option>
                            <option value="#">8</option>
                            <option value="#">9</option>
                        </select></p>
                    <button style="float:right; left: 100%;">Remove</button>
                    <!--Button created that would delete / remove the item from the cart-->
                </div>
            </div>

            <!--each lsited product would be created with a div called sideCart-->

            <div class="sideCart">
                <div class="itemImage"> <!-- Shows the image of the product-->
                    <img src="../images/StuffedToys/BlackDragon.jpg" alt="BlackDragon">
                </div>
                <div class="itemText"> <!--Div to control the texts of the product listed-->
                    <h1>Black Dragon</h1>
                    <p class="price">AED75.00</p>
                    <p><select style="width: 8%; text-align: center;">
                            <!-- A drop down menu that allows the user to select the quantity of each product-->
                            <option value="#" selected="selected"> 1 </option>
                            <option value="#">2</option>
                            <option value="#">3</option>
                            <option value="#">4</option>
                            <option value="#">5</option>
                            <option value="#">6</option>
                            <option value="#">7</option>
                            <option value="#">8</option>
                            <option value="#">9</option>
                        </select></p>
                    <button style="float:right; left: 100%;">Remove</button>
                    <!--Button created that would delete / remove the item from the cart-->
                </div>
            </div>
        </div>

        <!-- Item Summary -->
        <div class="sideSummaryContainer">
            <div class="sideSummary">
                <!--This will be on the right side of the page, a header that indicates the order summary-->
                <div style="margin-bottom: -7%;margin-top: -4%; margin-left: 3%; font-size:40px; ">
                    <p> Order Summary </p>
                </div>
                <div style="margin-top: -4%; margin-left: 4%;">
                    <p> Total Amount VAT Inclusive</p>
                </div>
                <div> <!--A Div is made to dispaly the order summary in a table-->
                    <table> <!--Below are the items stored in the table-->
                        <thead>
                            <tr>
                                <td style="width: 33%;">Item Name</td>
                                <td>Quantity</td>
                                <td>Price</td>
                            </tr>
                        </thead>
                        <tbody id="cartTable">
                            <!-- <tr>
                                <td>Brown Bear</td>
                                <td>x2</td>
                                <td>141.90</td>
                            </tr>
                            <tr>
                                <td>Black Dragon</td>
                                <td>x1</td>
                                <td>75.00</td>
                            </tr> -->
                        </tbody>
                    </table>
                </div>
                <div class="totalContainer"> <!--Total Container to display the Final price of the order-->
                    <div class="totalPrice" style="float: left;"> &nbsp;&nbsp;&nbsp;Total Amount </div>
                    <div class="totalPrice" style="float: right;"> 216.90 AED&nbsp;&nbsp;&nbsp; </div>
                </div>
                <h1 style="margin-left: 3%; margin-bottom: -1%;">People also Buy</h1>
                <div id="productRecommendation" class="productRecommendation">

                </div>
            </div>

            <!--  
            <div class="sideSummary">           This will be on the right side of the page, a header that indicates the order summary
                    <div style="margin-bottom: -7%;margin-top: -4%; margin-left: 3%; font-size:40px; ">
                        <p> Order Summary </p>
                    </div>
                    <div style="margin-top: -4%; margin-left: 4%;">
                        <p> Total Amount VAT Inclusive</p>
                    </div>
                    <div>               A Div is made to display the order summary in a table
                        <script>
                            <table>             Below are the items stored in the table
                                <thead>        
                                        htmlStr += "<tr>";
                                            htmlStr += "<td style="width: 33%;">Item Name</td>";
                                            htmlStr += "<td>Quantity</td>";
                                            htmlStr += "<td>Price<br></td>";
                                            htmlStr += "</tr>";
                                        htmlStr += "<tr>";
                                            htmlStr += "<td></td>";"
                                        htmlStr += "</tr>";
                                        htmlStr += "<tr>";
                                            <td>Brown Bear</td>
                                            <td>x2</td>
                                            <td>141.90</td>
                                        htmlStr += "</tr>";
                                        htmlStr += "<tr>";
                                            <td>Black Dragon</td>
                                            <td>x1</td>
                                            <td>75.00</td>
                                        htmlStr += "</tr>";
                                </thead>
                            </table>
                        </script>
                    </div>
                    <div class="totalContainer">        Total Container to display the Final price of the order
                        <div class="totalPrice" style="float: left;"> &nbsp;&nbsp;&nbsp;Total Amount </div>
                        <div class="totalPrice" style="float: right;"> 216.90 AED&nbsp;&nbsp;&nbsp; </div>
                    </div>

                    <div class="checkoutBtn">       A button that would be clicked to confirm and lead to final checkout
                        <a href="finalOrder.html"><button> Check Out </button></a>
                    </div>-->

            <!-- A container that would have product recommendations -->


        </div>
    </div>
    </div>

    <!-- js for searchbar functionality -->
    <script type="module">
        "use strict"
        //Import recommender class
        import { Recommender } from '../js/searchbar.js';

        //Create recommender object - it loads its state from session storage
        let recommender = new Recommender();

        //searchbar functionality
        let searchBar = document.getElementById("searchbar");
        searchBar.onsearch = function () {
            //add keyword to sessionStorage
            recommender.addKeyword(searchBar.value);
            //display searched product
            recommender.search();
        }

        let topKeyword = recommender.getTopKeyword();
        let container = document.getElementById("productRecommendation");

        window.onload = init;

        //Downloads JSON description of products from server
        function init() {
            //Create request object 
            let request = new XMLHttpRequest();

            //Create event handler that specifies what should happen when server responds
            request.onload = () => {
                //Check HTTP status code
                if (request.status === 200) {

                    //Add data from server to page

                    displayRecommendedProducts(request.responseText);
                }
                else
                    alert("Error communicating with server: " + request.status);
            };


            //Set up request and send it
            if (topKeyword != "" && topKeyword != "undefined") {
                request.open("GET", "../php/products.php?search=" + topKeyword);
            }
            else {
                request.open("GET", "../php/products.php");
            }
            request.send();
            window.Cart = getCart();
            displayCartTable();
        }

        function displayRecommendedProducts(jsonProducts) {

            if (jsonProducts == "]") {
                topKeyword = "";
                init();
            }

            //Convert JSON to array of product objects
            let prodArray = JSON.parse(jsonProducts);


            console.log(prodArray);
            let htmlStr = "";

            //Create HTML div containing product data
            let i = 0;
            let index = 0;
            let prodIDs = [];
            do {

                if (prodArray.length > 3) {
                    index = Math.floor(Math.random() * prodArray.length);
                    if (index in prodIDs) {
                        continue;
                    }
                }

                htmlStr += '<div class="recommendationCard">';
                // htmlStr += '<span style="visibility: hidden;" id="itemId">'+ prodArray[i]._id.$oid +'</span>';
                htmlStr += '<a href="productDisplay.html?name=' + prodArray[index].name + '">';
                htmlStr += '<img src="' + prodArray[index].image_url + '" alt="' + prodArray[index].name + '" style="width: 100%;">';
                htmlStr += '<h1>' + prodArray[index].name + '</h1>';
                htmlStr += '<p class="price">AED' + prodArray[index].price + '</p></a>';
                htmlStr += '<p><button>Add to Cart</button></p></div>';
                prodIDs.push(index);
                index += 1;
                i += 1;
            }
            while (i < 3 && i < prodArray.length);
            console.log(prodIDs);
            console.log(window.Cart);
            container.innerHTML = htmlStr;

        }

        function displayCartTable(){
            let cartTable = document.getElementById("cartTable");
            let cartList = window.Cart;
            let htmlStr = "";
            for (let i=0;i<cartList.length;i++){
                htmlStr += "<tr>";
                htmlStr += "<td>" + cartList[i].name + "</td>";
                htmlStr += "<td>" + cartList[i].qty + "</td>";
                htmlStr += "<td>" + cartList[i].qty * cartList[i].price + "</td>";
                htmlStr += "</tr>";
            }
            cartTable.innerHTML= htmlStr;

        }




    </script>
    </div>
    <footer>
        <p>©️ 2023 - STUFFINGTON - All Rights Reserved</p>
    </footer>
</body>

</html>